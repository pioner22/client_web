@media (max-width: 600px) {
  :root {
    --right-column-width: 100vw;
  }

  /* Mobile (Safari + PWA): всегда фуллскрин, независимо от выбранного скина. */
  html #app {
    --app-outer-pad: 0px;
    width: 100%;
    overscroll-behavior: none;
    padding: 0;
  }

  html.app-vv-offset #app {
    /* iOS: при открытии клавиатуры visualViewport может иметь offsetTop -> фиксируем "прыжки". */
    position: fixed;
    left: 0;
    right: 0;
    top: var(--app-vv-top, 0px);
    bottom: var(--app-vv-bottom, 0px);
    height: auto;
    min-height: 0;
  }

  html #app > .app {
    --app-max-width: 100%;
    --app-border-width: 0px;
    --app-border-color: transparent;
    --app-radius: 0px;
    --app-shadow: none;
    --app-overflow: hidden;
    --app-row-footer: 0px;
    margin: 0;
    border: 0;
    border-radius: 0;
    box-shadow: none;
    overflow: hidden;
  }

  :root[data-skin] {
    --app-outer-pad: 0px;
    --app-max-width: 100%;
    --app-border-width: 0px;
    --app-radius: 0px;
    --app-shadow: none;
    --app-overflow: hidden;
    --app-row-footer: 0px;
  }

  .grid {
    grid-template-columns: 1fr;
  }

  .right-col {
    display: none;
  }

  .nav-toggle {
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .chat-col {
    grid-column: 1;
    grid-row: 1;
  }

  .nav-overlay {
    position: absolute;
    inset: 0;
    background: var(--overlay-bg);
    z-index: 40;
    touch-action: none;
  }

  .sidebar {
    display: flex;
    flex-direction: column;
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    width: 100vw;
    max-width: 100vw;
    padding-top: calc(var(--sidebar-pad) + env(safe-area-inset-top));
    padding-bottom: var(--sidebar-pad);
    transform: translateX(-110%);
    transition: transform 160ms ease;
    z-index: 41;
    overflow: hidden;
  }

  .sidebar.sidebar-mobile-open {
    transform: translateX(0);
  }

  /* Mobile: swipe transition between sidebar tabs (Telegram-like). */
  .sidebar[data-swipe-active="1"] .sidebar-mobile-sticky,
  .sidebar[data-swipe-active="1"] .sidebar-body {
    transform: translate3d(var(--sidebar-swipe-x, 0px), 0, 0) scale(var(--sidebar-swipe-scale, 1));
    opacity: var(--sidebar-swipe-opacity, 1);
    will-change: transform;
  }

  .sidebar[data-swipe-active="1"][data-swipe-anim="1"] .sidebar-mobile-sticky,
  .sidebar[data-swipe-active="1"][data-swipe-anim="1"] .sidebar-body {
    transition: transform 180ms cubic-bezier(0.2, 0.9, 0.2, 1), opacity 180ms ease;
  }

  @media (prefers-reduced-motion: reduce) {
    .sidebar[data-swipe-active="1"][data-swipe-anim="1"] .sidebar-mobile-sticky,
    .sidebar[data-swipe-active="1"][data-swipe-anim="1"] .sidebar-body {
      transition: none;
    }
  }

  .sidebar-mobile-sticky {
    position: sticky;
    top: 0;
    z-index: 2;
    background: var(--sidebar-bg);
    padding-bottom: 0;
    margin-bottom: 0;
  }

  .sidebar-searchbar {
    margin-bottom: 0;
  }

  .sidebar-contact-sort {
    margin-bottom: 0;
  }

  .sidebar-contact-sort.search-filters {
    margin-top: 0;
  }

  .sidebar-mobile-bottom {
    display: block;
    z-index: 3;
    background: var(--sidebar-bg);
    border-top: 1px solid color-mix(in srgb, var(--line), transparent 60%);
    padding-top: var(--sp-2);
    padding-bottom: max(var(--sp-2), var(--safe-bottom-layout-pad));
    padding-inline: var(--sidebar-list-pad);
    margin-top: 0;
  }

  .sidebar-mobile-top {
    display: flex;
    padding-bottom: var(--sp-2);
    margin-bottom: var(--sp-2);
  }

  .sidebar-desktop-bottom {
    display: none;
  }

  /* На мобильных не перегружаем шапку версиями/ID: важнее заголовок и статус. */
  .hdr-label,
  .hdr-id,
  .hdr-ver,
  .hdr-sep {
    display: none;
  }

  .hdr-title {
    font-weight: 600;
  }

  .page {
    padding: var(--sp-4);
    padding-bottom: calc(var(--sp-4) + var(--safe-bottom-layout-pad));
  }

  .member-row {
    flex-direction: column;
    align-items: flex-start;
  }

  .member-actions {
    width: 100%;
    justify-content: flex-start;
  }

  /* Страницы (help/profile/search/files/create) на мобильных выглядят как «экран приложения», а не popup-card. */
  .chat.chat-page {
    padding: 0;
    background: var(--panel);
  }

  .chat.chat-page .page {
    border: 0;
    border-radius: 0;
    box-shadow: none;
    background: var(--panel);
    min-height: 100%;
  }

  .chat.chat-page .page.page-create {
    min-height: auto;
  }

  /* Mobile: нижние tab-кнопки убраны (навигация живёт в «Меню» / Контакты). */
  .footer {
    display: none;
  }

  .toast-host {
    bottom: calc(var(--safe-bottom-pad) + 86px);
  }
}

@media (min-width: 601px) and (max-width: 925px) {
  :root {
    --floating-sidebar-width: 26.5rem;
    --floating-sidebar-shift: calc(26.5rem + 1px);
    --floating-sidebar-peek: 5rem;
  }

  .grid {
    grid-template-columns: 1fr;
  }

  .nav-toggle {
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .chat-col {
    grid-column: 1;
    grid-row: 1;
    transition: transform 160ms ease;
  }

  .nav-overlay {
    position: absolute;
    inset: 0;
    background: var(--overlay-bg);
    z-index: 40;
    touch-action: none;
  }

  body.has-right-col .right-col {
    display: flex;
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    width: var(--right-column-width);
    max-width: 100%;
    z-index: 42;
    box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.22);
  }

  .sidebar {
    display: flex;
    flex-direction: column;
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    width: var(--floating-sidebar-width);
    max-width: min(var(--floating-sidebar-width), 92vw);
    transform: translateX(calc(var(--floating-sidebar-peek) * -1));
    transition: transform 160ms ease;
    z-index: 41;
    overflow: hidden;
  }

  .sidebar.sidebar-float-open {
    transform: translateX(0);
  }

  html.floating-sidebar-open .chat-col {
    transform: translateX(var(--floating-sidebar-shift));
  }

  @media (prefers-reduced-motion: reduce) {
    .chat-col {
      transition: none;
    }

    .sidebar {
      transition: none;
    }
  }
}

@media (min-width: 1276px) and (max-width: 1680px) {
  :root {
    --app-max-width: 100%;
    --right-column-width: 25vw;
  }
}

@media (min-width: 1681px) {
  :root {
    --app-max-width: 1680px;
  }
}

@media (max-width: 600px) and (pointer: coarse) {
  :root[data-skin] {
    --font-family: var(--sans);
    --font-size: 16px;
    --font-weight: 450;

    --header-pad-y: var(--sp-2);
    --header-pad-x: var(--sp-3);
    --header-gap-y: var(--sp-1);
    --header-gap-x: var(--sp-3);

    --sidebar-pad: 0px;
    --sidebar-list-pad: 0px;

    --chat-pad: 8px;
    --msg-body-max-width: calc(100% - var(--message-handhelds-margin));
    --chat-line-gap: 8px;
    --msg-pad-y: 3px;
    --msg-avatar-size: 32px;
    --msg-avatar-font-size: 12px;
    --chat-title-avatar-size: 24px;
    --chat-title-avatar-font-size: 11px;

    --msg-in-border-width: 0px;
    --msg-out-border-width: 0px;
    --msg-in-bg: color-mix(in srgb, var(--panel), transparent 0%);
    --msg-out-bg: color-mix(in srgb, var(--focus), var(--panel2) 88%);
    --msg-in-radius: 15px;
    --msg-in-cont-corner: 12px;
    --msg-out-radius: 15px;
    --msg-out-cont-corner: 12px;
    --msg-in-pad-y: 4px;
    --msg-in-pad-x: 8px;
    --msg-in-pad-bottom: 5px;
    --msg-out-pad-y: 4px;
    --msg-out-pad-x: 8px;
    --msg-out-pad-bottom: 5px;

    --row-pad-y: 7px;
    --row-pad-x: 16px;
    --row-gap: 16px;
    --avatar-size: 40px;
    --avatar-font-size: 14px;

    --pane-section-mt: var(--sp-3);
    --pane-section-mb: var(--sp-2);

    --composer-pad-y: var(--sp-1);
    --composer-pad-x: var(--sp-3);
    --composer-gap: var(--sp-1);
    --composer-field-radius: 16px;
    --composer-field-border-width: 0px;
    --composer-field-bg: color-mix(in srgb, var(--panel2), transparent 4%);
    --composer-input-font-family: var(--font-family);
    --composer-input-font-weight: 500;
    --composer-field-pad: 4px;
    --composer-field-min-h: 46px;
    --composer-btn-size: 46px;
  }

  :root[data-skin][data-msg-view="plain"] {
    --msg-in-bg: transparent;
    --msg-out-bg: transparent;
    --msg-in-border-width: 0;
    --msg-out-border-width: 0;
    --msg-in-pad-y: 0;
    --msg-in-pad-x: 0;
    --msg-in-pad-bottom: 0;
    --msg-out-pad-y: 0;
    --msg-out-pad-x: 0;
    --msg-out-pad-bottom: 0;
    --msg-pad-y: 1px;
    --chat-line-gap: 2px;
    --msg-body-max-width: min(100%, 980px);
    --msg-in-justify: flex-start;
    --msg-out-justify: flex-start;
  }

  :root[data-skin][data-msg-view="compact"] {
    --msg-in-bg: transparent;
    --msg-out-bg: transparent;
    --msg-in-border-width: 0;
    --msg-out-border-width: 0;
    --msg-in-pad-y: 0;
    --msg-in-pad-x: 0;
    --msg-in-pad-bottom: 0;
    --msg-out-pad-y: 0;
    --msg-out-pad-x: 0;
    --msg-out-pad-bottom: 0;
    --msg-pad-y: 1px;
    --chat-line-gap: 3px;
    --msg-body-max-width: min(100%, 940px);
    --msg-in-radius: 0;
    --msg-out-radius: 0;
    --msg-in-justify: flex-start;
    --msg-out-justify: flex-start;
    --msg-avatar-size: 0px;
    --msg-avatar-font-size: 0px;
  }

  /* Dialog list: closer to Telegram density. */
  .sidebar .row {
    border-radius: 0;
    border-bottom: 1px solid color-mix(in srgb, var(--line), transparent 60%);
  }

  .sidebar .row-sel {
    border-bottom-color: color-mix(in srgb, var(--line), transparent 72%);
  }

  .sidebar .row-tail {
    flex-direction: column;
    align-items: flex-end;
    gap: 4px;
  }

  .sidebar .row-title {
    font-weight: 500;
  }

  .sidebar .row-sub {
    font-size: 12px;
  }

  .sidebar .row-time {
    font-size: 12px;
  }

  .sidebar .row-unread {
    min-width: 22px;
    height: 22px;
    padding: 0 7px;
    font-size: 11px;
  }

  /* Telegram-like header: title on top, status under it. */
  .hdr {
    grid-template-columns: 1fr;
    grid-template-rows: auto auto;
  }

  .hdr-left {
    grid-column: 1;
    grid-row: 1;
    display: flex;
    align-items: center;
    gap: var(--sp-2);
  }

  .hdr-title {
    flex: 1 1 auto;
    min-width: 0;
  }

  .hk-btn.hdr-search {
    min-width: 44px;
    width: 44px;
    height: 44px;
    padding: 0;
    /* Telegram-like: icon button without a chunky background box */
    border-radius: 999px;
    font-size: 0;
    display: grid;
    place-items: center;
    background: transparent;
    border-color: transparent;
  }

  .hk-btn.hdr-search::before {
    content: "";
    width: 20px;
    height: 20px;
    background: currentColor;
    opacity: 0.92;
    -webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M10.5 3a7.5 7.5 0 1 1 4.6 13.4l3.15 3.15a1 1 0 0 1-1.42 1.42l-3.15-3.15A7.5 7.5 0 0 1 10.5 3Zm0 2a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11Z'/%3E%3C/svg%3E")
      no-repeat center / contain;
    mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M10.5 3a7.5 7.5 0 1 1 4.6 13.4l3.15 3.15a1 1 0 0 1-1.42 1.42l-3.15-3.15A7.5 7.5 0 0 1 10.5 3Zm0 2a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11Z'/%3E%3C/svg%3E")
      no-repeat center / contain;
  }

  .hk-btn.hdr-search.btn-active::before {
    -webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M18.3 5.7a1 1 0 0 0-1.4 0L12 10.6 7.1 5.7a1 1 0 0 0-1.4 1.4l4.9 4.9-4.9 4.9a1 1 0 1 0 1.4 1.4l4.9-4.9 4.9 4.9a1 1 0 0 0 1.4-1.4L13.4 12l4.9-4.9a1 1 0 0 0 0-1.4Z'/%3E%3C/svg%3E")
      no-repeat center / contain;
    mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M18.3 5.7a1 1 0 0 0-1.4 0L12 10.6 7.1 5.7a1 1 0 0 0-1.4 1.4l4.9 4.9-4.9 4.9a1 1 0 1 0 1.4 1.4l4.9-4.9 4.9 4.9a1 1 0 0 0 1.4-1.4L13.4 12l4.9-4.9a1 1 0 0 0 0-1.4Z'/%3E%3C/svg%3E")
      no-repeat center / contain;
  }

  .hdr-right {
    grid-column: 1;
    grid-row: 2;
    text-align: left;
    max-width: 100%;
    font-size: 12px;
    line-height: 1.25;
    opacity: 0.9;
  }

  /* На тач-устройствах горячие клавиши не нужны — освобождаем место. */
  .hotkeys {
    display: none;
  }

  /* На мобилке заголовок чата уже есть в шапке — не дублируем над сообщениями. */
  .chat > .chat-title,
  .chat > .chat-top > .chat-title {
    display: none;
  }

  /* Страницы: заголовок/назад уже есть в шапке — убираем дубли и подсказки под клавиатуру. */
  .page .chat-title {
    display: none;
  }

  .page-hint {
    display: none;
  }

  /* Профиль/контакт на мобилке выглядят как «экран Telegram»: крупный аватар + центрирование. */
  .page-profile .profile-head-top {
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: var(--sp-3);
  }

  .page-profile .profile-head-main {
    justify-items: center;
    text-align: center;
  }

  .page-profile .avatar-xl {
    width: 96px;
    height: 96px;
    font-size: 26px;
  }

  .page-profile .profile-name {
    font-size: 20px;
  }

  .page-profile .profile-handle {
    font-size: 14px;
  }

  .page-profile .profile-head-actions {
    width: 100%;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--sp-2);
  }

  .page-profile .profile-head-actions .btn {
    width: 100%;
    min-height: 44px;
  }

  .page-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: var(--sp-3);
  }

  .page-actions .btn {
    width: 100%;
    min-height: 44px;
  }

  .msg-in .msg-body,
  .msg-out .msg-body {
    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.22);
  }

  /* Composer: closer to Telegram pill + stable "bar" feel. */
  .input-wrap {
    background: color-mix(in srgb, var(--composer-bg), transparent 10%);
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
  }

  /* iOS: blur/transparency can create an extra "dark strip" near the bottom safe-area. Keep the bar solid. */
  html.is-ios .input-wrap {
    background: var(--composer-bg);
    -webkit-backdrop-filter: none;
    backdrop-filter: none;
  }

  .composer-row {
    width: 100%;
  }

  .sidebar-bottom-dock {
    display: none;
  }

  @supports not ((backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px))) {
    .input-wrap {
      background: var(--composer-bg);
    }
  }

  .composer-field {
    box-shadow: 0 18px 48px rgba(0, 0, 0, 0.24);
  }

  .composer-field .input {
    padding: 6px 0;
  }

  .btn.composer-attach {
    font-size: 0;
  }

  .btn.composer-attach::before {
    content: "";
    width: 20px;
    height: 20px;
    background: currentColor;
    opacity: 0.9;
    -webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M16.5 6.5 9.1 13.9a3 3 0 0 0 4.2 4.2l7.1-7.1a5 5 0 1 0-7.1-7.1L6.2 11a7 7 0 1 0 9.9 9.9l6.4-6.4a1 1 0 1 0-1.4-1.4l-6.4 6.4a5 5 0 1 1-7.1-7.1l7.1-7.1a3 3 0 1 1 4.2 4.2l-7.1 7.1a1 1 0 1 1-1.4-1.4l7.4-7.4a1 1 0 1 0-1.4-1.4Z'/%3E%3C/svg%3E")
      no-repeat center / contain;
    mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M16.5 6.5 9.1 13.9a3 3 0 0 0 4.2 4.2l7.1-7.1a5 5 0 1 0-7.1-7.1L6.2 11a7 7 0 1 0 9.9 9.9l6.4-6.4a1 1 0 1 0-1.4-1.4l-6.4 6.4a5 5 0 1 1-7.1-7.1l7.1-7.1a3 3 0 1 1 4.2 4.2l-7.1 7.1a1 1 0 1 1-1.4-1.4l7.4-7.4a1 1 0 1 0-1.4-1.4Z'/%3E%3C/svg%3E")
      no-repeat center / contain;
  }

  .pane-section {
    text-transform: uppercase;
    letter-spacing: 0.06em;
    font-size: 11px;
  }

  /* Telegram-like list rows in sidebar. */
  .sidebar {
    --row-bg-hover: color-mix(in srgb, var(--panel), transparent 25%);
    --row-bg-selected: color-mix(in srgb, var(--focus), var(--panel) 92%);
    --row-bg-selected-hover: var(--row-bg-selected);
    --row-text-selected: var(--text);
    --row-text-selected-hover: var(--text);
    --row-text-selected-muted: color-mix(in srgb, var(--text), var(--muted) 40%);
    --row-text-selected-muted-hover: var(--row-text-selected-muted);
  }

  .sidebar .row {
    border-radius: 0;
    background: transparent;
    border-bottom: 1px solid color-mix(in srgb, var(--line), transparent 60%);
  }

  .sidebar .row[data-ctx-kind] {
    border-bottom: 0;
    position: relative;
    min-height: var(--row-min-h);
    /* tweb-like "row-grid": stable columns (avatar / main / meta) and two rows (title + subtitle). */
    display: grid;
    grid-template-columns: var(--avatar-size) minmax(0, 1fr) auto;
    grid-template-rows: auto auto;
    grid-template-areas: "ava title tail" "ava sub tail";
    column-gap: var(--row-gap);
    row-gap: 2px;
    align-items: center;
  }

  .sidebar .row[data-ctx-kind]::after {
    content: "";
    position: absolute;
    left: calc(var(--row-pad-x) + var(--avatar-size) + var(--row-gap));
    right: 0;
    bottom: 0;
    height: 1px;
    background: color-mix(in srgb, var(--line), transparent 70%);
    pointer-events: none;
  }

  .sidebar .row[data-ctx-kind] > .avatar {
    grid-area: ava;
    align-self: center;
  }

  .sidebar .row[data-ctx-kind] > .row-main {
    display: contents;
  }

  .sidebar .row[data-ctx-kind] .row-title {
    grid-area: title;
    align-self: flex-end;
    min-width: 0;
  }

  .sidebar .row[data-ctx-kind] .row-sub {
    grid-area: sub;
    align-self: flex-start;
    min-width: 0;
  }

  .sidebar .row[data-ctx-kind] > .row-tail {
    grid-area: tail;
    margin-left: 0;
    align-self: stretch;
    justify-self: end;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 4px;
  }


  .sidebar .row:hover {
    background: var(--row-bg-hover);
  }

  .sidebar:not([data-sidebar-tab="menu"]) .row-sel {
    background: var(--row-bg);
  }

  .sidebar[data-sidebar-tab="menu"] .row-sel {
    background: var(--row-bg-selected);
  }

  .sidebar .row-sel[data-ctx-kind]::after {
    background: transparent;
  }

  .sidebar[data-sidebar-tab="menu"] {
    --row-pad-y: 12px;
    --row-pad-x: 14px;
    --row-gap: 12px;
    --row-radius: 14px;
    --row-bg: color-mix(in srgb, var(--panel2), transparent 8%);
    --row-bg-hover: color-mix(in srgb, var(--panel2), var(--panel) 20%);
    --row-bg-selected: color-mix(in srgb, var(--focus), transparent 82%);
  }

  .sidebar[data-sidebar-tab="menu"] .row {
    border: 1px solid color-mix(in srgb, var(--line), transparent 55%);
    background: var(--row-bg);
    box-shadow: 0 6px 16px color-mix(in srgb, var(--panel), transparent 86%);
  }

  .sidebar[data-sidebar-tab="menu"] .row:active {
    background: color-mix(in srgb, var(--row-bg-selected), var(--panel) 60%);
  }

  .sidebar[data-sidebar-tab="menu"] .row-prefix {
    width: 26px;
    text-align: center;
    font-size: 18px;
    font-weight: 700;
    color: var(--focus);
  }

  .sidebar[data-sidebar-tab="menu"] .row-label {
    font-weight: 600;
    font-size: 15px;
  }

  .sidebar[data-sidebar-tab="menu"] .row-sub {
    font-size: 12px;
  }

  .sidebar .row-tail {
    flex-direction: column;
    align-items: flex-end;
    gap: 6px;
  }

  .sidebar .row-draft {
    display: none;
  }

  .sidebar-mobile-top {
    padding-bottom: var(--sp-2);
    margin-bottom: var(--sp-2);
  }

  .footer-nav {
    width: 100%;
    border-radius: 16px;
  }

  .footer-tab {
    height: 56px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2px;
    font-size: 11px;
  }

  .footer-tab::before {
    content: "";
    width: 22px;
    height: 22px;
    background: currentColor;
    opacity: 0.92;
    -webkit-mask: var(--footer-tab-icon) no-repeat center / contain;
    mask: var(--footer-tab-icon) no-repeat center / contain;
  }

  .footer-tab[data-action="nav-main"] {
    --footer-tab-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M4 4.5C4 3.12 5.12 2 6.5 2h11C18.88 2 20 3.12 20 4.5v9c0 1.38-1.12 2.5-2.5 2.5H10l-4.2 3.2c-.66.5-1.8.05-1.8-.84V16H6.5C5.12 16 4 14.88 4 13.5v-9Z'/%3E%3C/svg%3E");
  }

  .footer-tab[data-action="nav-search"] {
    --footer-tab-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M10.5 3a7.5 7.5 0 1 1 4.6 13.4l3.15 3.15a1 1 0 0 1-1.42 1.42l-3.15-3.15A7.5 7.5 0 0 1 10.5 3Zm0 2a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11Z'/%3E%3C/svg%3E");
  }

  .footer-tab[data-action="nav-profile"] {
    --footer-tab-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M12 3a5 5 0 1 1 0 10 5 5 0 0 1 0-10Zm0 12c4.42 0 8 2.24 8 5v1H4v-1c0-2.76 3.58-5 8-5Z'/%3E%3C/svg%3E");
  }

  .footer-tab[data-action="nav-files"] {
    --footer-tab-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M7 2h7l5 5v15a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2Zm7 1.5V8h4.5L14 3.5ZM8 11h8v2H8v-2Zm0 4h8v2H8v-2Z'/%3E%3C/svg%3E");
  }
}

@media (pointer: coarse) {
  /* Touch devices (phones/tablets): no keyboard-only hints. */
  .hotkeys {
    display: none;
  }

  .help-grid,
  .help-hotkeys-title {
    display: none;
  }

  .page-hint {
    display: none;
  }

  /* iOS/Safari: long-press on message text shows native “Copy/Translate” callout.
     We use our own message context menu, so suppress text callout/selection on touch. */
  .msg-text,
  .msg-from,
  .msg-meta,
  .msg-time,
  .msg-edited,
  .msg-mention,
  .msg-link {
    user-select: none;
    -webkit-user-select: none;
    -webkit-touch-callout: none;
  }
}

/* ===== Mobile composer controls ===== */
@media (pointer: coarse) and (max-width: 600px) {
  /* Phones/tablets: keep the composer minimal (phone keyboards already have emoji + send). */
  .btn.composer-emoji {
    display: none;
  }

  /* Chat header: icon-only search toggle (cleaner on mobile). */
  .btn.chat-search-toggle {
    min-width: 40px;
    width: 40px;
    height: 40px;
    padding: 0;
    border-radius: 12px;
    border-color: transparent;
    background: transparent;
    font-size: 0;
    line-height: 1;
    display: grid;
    place-items: center;
  }

  .btn.chat-search-toggle::before {
    content: "";
    width: 20px;
    height: 20px;
    background: currentColor;
    opacity: 0.9;
    -webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M10.5 3a7.5 7.5 0 1 1 4.6 13.4l3.15 3.15a1 1 0 0 1-1.42 1.42l-3.15-3.15A7.5 7.5 0 0 1 10.5 3Zm0 2a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11Z'/%3E%3C/svg%3E")
      no-repeat center / contain;
    mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M10.5 3a7.5 7.5 0 1 1 4.6 13.4l3.15 3.15a1 1 0 0 1-1.42 1.42l-3.15-3.15A7.5 7.5 0 0 1 10.5 3Zm0 2a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11Z'/%3E%3C/svg%3E")
      no-repeat center / contain;
  }

  .btn.chat-search-toggle.btn-active {
    background: color-mix(in srgb, var(--btn-bg-hover), transparent 25%);
  }

  .btn.chat-search-toggle.btn-active::before {
    -webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M18.3 5.71a1 1 0 0 1 0 1.41L13.41 12l4.89 4.88a1 1 0 1 1-1.41 1.42L12 13.41 7.12 18.3a1 1 0 0 1-1.42-1.41L10.59 12 5.7 7.12A1 1 0 0 1 7.12 5.7L12 10.59l4.88-4.89a1 1 0 0 1 1.42 0Z'/%3E%3C/svg%3E")
      no-repeat center / contain;
    mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M18.3 5.71a1 1 0 0 1 0 1.41L13.41 12l4.89 4.88a1 1 0 1 1-1.41 1.42L12 13.41 7.12 18.3a1 1 0 0 1-1.42-1.41L10.59 12 5.7 7.12A1 1 0 0 1 7.12 5.7L12 10.59l4.88-4.89a1 1 0 0 1 1.42 0Z'/%3E%3C/svg%3E")
      no-repeat center / contain;
  }
}

@media (max-width: 600px) and (prefers-reduced-motion: reduce) {
  .sidebar {
    transition: none;
  }
}

@media (display-mode: standalone), (display-mode: fullscreen) {
  :root {
    --app-outer-pad: 0px;
    --app-max-width: 100%;
    --app-border-width: 0px;
    --app-radius: 0px;
    --app-shadow: none;
    --app-overflow: hidden;
  }
}
