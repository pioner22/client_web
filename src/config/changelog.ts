export interface ChangelogEntry {
  version: string; // semver without build hash
  date: string; // YYYY-MM-DD
  added?: string[];
  improved?: string[];
  fixed?: string[];
  notes?: string[];
}

// Keep newest first. This list is shown in Info (F1) and acts as user-facing release notes.
export const CHANGELOG: ChangelogEntry[] = [
  {
    version: "0.1.76",
    date: "2025-12-22",
    added: [
      "Контакт: отдельная страница профиля (аватар/имя/@handle/ID/статус/био)",
      "Regress tests: sidebar display_name, avatar_rev storage, handleServerMessage avatar",
    ],
    improved: [
      "Контакты/чаты: если у пользователя задано имя, показываем его вместо голого ID (в сайдбаре, шапке и статус-строке)",
      "Профиль: добавлены поля «Статус» и «О себе» (bio), сохранение через серверный profile_set",
      "Аватары: серверная синхронизация (avatar_set/clear/get) + локальный кэш с avatar_rev",
    ],
  },
  {
    version: "0.1.75",
    date: "2025-12-22",
    improved: [
      "Файлы/медиа: вложения в чате и на странице «Файлы» теперь выглядят как аккуратные карточки (иконка типа, превью сверху для изображений, компактные кнопки действий)",
      "Прикрепление: выбор нескольких файлов за раз (multi-select) — удобнее отправлять пачками",
    ],
    fixed: ["UI: иконки действий у файлов (accept/reject/download) корректно отображаются во всех браузерах"],
    added: ["Regress tests: fileBadge и renderChatFileRow"],
  },
  {
    version: "0.1.74",
    date: "2025-12-22",
    improved: [
      "PWA update: service worker активируется сразу после установки (skipWaiting) — обновления подхватываются надёжнее",
      "PWA update: если SW уже на новой версии, а вкладка ещё на старой — делаем тихий перезапуск только когда безопасно (idle + нет активных загрузок + нет фокуса в полях ввода)",
      "Boot: при обновлении сначала делаем один «мягкий» reload (как Ctrl+R), и только потом — тяжёлый recover (unregister SW + очистка caches), если запуск всё ещё не удался",
    ],
    added: ["Regress test: shouldReloadForBuild — проверка логики «нужен ли перезапуск по buildId»"],
  },
  {
    version: "0.1.73",
    date: "2025-12-22",
    fixed: ["Чат: закреп/поиск теперь физически отделены от истории и не «уезжают» при прокрутке"],
    improved: ["Чат: скролл перенесён в chatHost (стабильнее jump‑to‑bottom и автоподгрузка истории)"],
    added: ["Regress test: chatFixedTop — проверка, что закреп/поиск рендерятся в chatTop, а не внутри истории"],
  },
  {
    version: "0.1.72",
    date: "2025-12-22",
    fixed: ["Сайдбар: ПКМ/Ctrl+Click больше не активирует строку и не должен «дёргать» прокрутку списка"],
    improved: ["iOS PWA: усилили workaround для панели Undo/Redo/✓ (включаем autocapitalize=sentences вместе с autocorrect/spellcheck)"],
    added: ["Regress test: sidebarContextClick — проверка, что Ctrl+Click/ПКМ не меняет выбранный чат"],
  },
  {
    version: "0.1.71",
    date: "2025-12-22",
    improved: [
      "Автовход: в шапке показываем «Входим…» (можно открыть вход вручную), чтобы меньше было «дёрганий» при старте",
      "Сессии: при успешном входе обновляем срок жизни токена в cookie/localStorage (даже если сервер не присылает session повторно)",
      "Composer: эмодзи‑кнопка теперь корректно disabled, а поповер закрывается при смене чата/страницы",
    ],
    added: ["Security regression: тесты на формат/хранилище session token и cookie‑параметры (SameSite=Strict, Secure на https)"],
  },
  {
    version: "0.1.70",
    date: "2025-12-22",
    added: ["Composer: кнопка эмодзи с быстрым пикером и списком «недавних» (локально на устройстве)"],
    improved: ["Профиль: аккуратная шапка (аватар/имя/@handle/ID) и секции «Аккаунт/Интерфейс» — ближе к привычному стилю мессенджеров"],
  },
  {
    version: "0.1.69",
    date: "2025-12-22",
    improved: [
      "Mobile: нижняя панель навигации убрана — теперь экран чище, а composer находится строго внизу (с учётом safe-area)",
      "Mobile: в боковом меню добавлены вкладки «Чаты/Контакты» (как в Telegram по смыслу): «Чаты» показывает только начатые диалоги и комнаты, «Контакты» — адресную книгу + навигацию (Поиск/Профиль/Файлы/Info)",
    ],
  },
  {
    version: "0.1.68",
    date: "2025-12-21",
    fixed: [
      "Чат: панель закрепа и поиск теперь закреплены над историей и не «уезжают» при прокрутке",
      "Редактирование сообщений: правка применяется устойчивее (fallback по msg_id, даже если в payload нет room/to)",
      "Сайдбар: ПКМ/Ctrl+Click больше не должен «ронять» скролл списка (lock scroll во время открытия меню)",
    ],
  },
  {
    version: "0.1.67",
    date: "2025-12-21",
    improved: ["Надёжность отправки: добавлена локальная outbox‑очередь (offline→send) с автоповтором на reconnect и дедупом по истории"],
  },
  {
    version: "0.1.66",
    date: "2025-12-21",
    fixed: ["Сайдбар: остаточные «скачки» скролла при ПКМ/Ctrl+Click по контактам/чатам устранены (стабилизация scroll snapshot + дедуп Pointer/Mouse)"],
  },
  {
    version: "0.1.65",
    date: "2025-12-21",
    fixed: ["Надёжность отправки: ACK (msg_id) теперь присваивается FIFO, без риска перепутать статусы при быстрой отправке нескольких сообщений"],
  },
  {
    version: "0.1.64",
    date: "2025-12-21",
    improved: ["Mobile: общий UI‑шрифт стал более «телеграмовским» (system sans), список чатов получил разделители с отступом от аватара"],
  },
  {
    version: "0.1.63",
    date: "2025-12-21",
    improved: [
      "Composer: кнопка отправки теперь выглядит «неактивной», когда отправлять нельзя (не вводит в заблуждение)",
      "Mobile: поле ввода сообщений использует системный sans‑шрифт (ближе к Telegram по ощущению)",
      "Автофокус composer: на iPad/гибридных устройствах с мышью/трекпадом фокус ставится сразу после выбора чата",
    ],
  },
  {
    version: "0.1.62",
    date: "2025-12-21",
    improved: ["Labs: ios-input-assistant.html теперь содержит атрибуты поля ввода прямо в HTML (проверка работает даже при строгом CSP)"],
  },
  {
    version: "0.1.61",
    date: "2025-12-21",
    improved: [
      "iOS PWA: workaround для панели Undo/Redo/✓ применяется при фокусе на текстовые поля (кроме полей ID/@handle)",
      "Добавлена диагностическая страница: /labs/ios-input-assistant.html",
    ],
  },
  {
    version: "0.1.60",
    date: "2025-12-21",
    improved: ["Авторизация: добавлены кнопки «показать/скрыть пароль» в окне входа/регистрации"],
  },
  {
    version: "0.1.59",
    date: "2025-12-21",
    fixed: ["ПКМ по контакту/чату в сайдбаре больше не «роняет» скролл списка (стабилизация до/после contextmenu)"],
  },
  {
    version: "0.1.58",
    date: "2025-12-21",
    improved: ["Убран неиспользуемый legacy web-код (старые файлы app/state/main/style) — меньше путаницы и «мертвых меню»"],
  },
  {
    version: "0.1.57",
    date: "2025-12-21",
    improved: [
      "Composer: кнопка отправки теперь единообразно «ягодка» (без конфликтующих стилей), в режиме редактирования — галочка",
      "Каретка в поле ввода сообщений: оставили нативную (меньше «скачет» на десктопе)",
    ],
  },
  {
    version: "0.1.56",
    date: "2025-12-21",
    added: ["Info (F1) с журналом изменений и мини‑инструкцией прямо в приложении"],
    improved: ["Подгрузка истории изменений порциями по 20 версий (автоподгрузка при прокрутке)"],
  },
  {
    version: "0.1.55",
    date: "2025-12-21",
    fixed: ["После выхода показываем сохранённый ID в шапке (ID больше не «пропадает»)"],
  },
  {
    version: "0.1.54",
    date: "2025-12-21",
    fixed: ["ID в окне входа не очищается при первом открытии модалки (после выхода просит только пароль)"],
    improved: ["Workaround для iOS PWA: панель Undo/Redo/✓ появляется реже при вводе текста"],
  },
];
