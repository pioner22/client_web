export interface ChangelogEntry {
  version: string; // semver without build hash
  date: string; // YYYY-MM-DD
  added?: string[];
  improved?: string[];
  fixed?: string[];
  notes?: string[];
}

// Keep newest first. This list is shown in Info (F1) and acts as user-facing release notes.
export const CHANGELOG: ChangelogEntry[] = [
  {
    version: "0.1.171",
    date: "2025-12-25",
    fixed: [
      "iPhone PWA: подложка safe‑area снизу закрашивается фоном приложения (без чёрных углов)",
      "Mobile: html/body минимум 100dvh для стабильного фона на экранах со скруглением",
    ],
  },
  {
    version: "0.1.170",
    date: "2025-12-25",
    fixed: [
      "iPhone PWA: высота #app не ниже 100dvh (меньше чёрной полосы снизу)",
      "iOS клавиатура: при фокусе остаётся высота по --app-vh, без лишнего растяжения",
    ],
  },
  {
    version: "0.1.169",
    date: "2025-12-25",
    fixed: [
      "iPhone PWA: уменьшен нижний отступ, safe‑area ограничен и #app расширен по высоте",
      "Mobile: меньше пустого места снизу в контактах и при вводе",
    ],
  },
  {
    version: "0.1.168",
    date: "2025-12-25",
    fixed: [
      "iPhone PWA: уменьшен нижний отступ и убрана чёрная полоса (контакты и компоузер)",
      "Mobile: корректнее заполняется высота экрана через --app-vh",
    ],
  },
  {
    version: "0.1.167",
    date: "2025-12-25",
    improved: [
      "Меню вкладок: прозрачный фон без боковой заливки, список контактов видно при прокрутке",
      "Mobile: вкладки также без боковой заливки, фон прозрачный",
    ],
  },
  {
    version: "0.1.166",
    date: "2025-12-24",
    improved: [
      "Сайдбар: вкладки Контакты/Доски/Чаты встроены в левую колонку и доходят до нижнего края",
      "Чат: компоузер перенесён внутрь правой колонки, панель слева больше не обрывается над полем ввода",
    ],
  },
  {
    version: "0.1.165",
    date: "2025-12-24",
    improved: [
      "Десктоп: нижние вкладки (Контакты/Доски/Чаты) закреплены в одном месте во всех меню",
      "Компоузер: при открытии страниц (не main) нижняя панель остаётся с вкладками, поле ввода скрывается",
    ],
  },
  {
    version: "0.1.164",
    date: "2025-12-24",
    fixed: [
      "Мобильный fullscreen: #app привязан к top/bottom visualViewport, меньше шансов на чёрную полосу",
      "Сайдбар: список скроллится в отдельном контейнере, нижние вкладки остаются на месте",
      "Контекстное меню: стабилизация скролла учитывает новый контейнер сайдбара",
    ],
  },
  {
    version: "0.1.163",
    date: "2025-12-24",
    improved: [
      "Мобильное контекстное меню: лист прижат к нижнему краю (как в Telegram)",
      "Компоузер: батчинг ввода снижает лаг каретки в PWA desktop",
      "Мобильный fullscreen: #app фиксирован к краям экрана",
    ],
  },
  {
    version: "0.1.162",
    date: "2025-12-24",
    improved: [
      "Сайдбар: вкладки разделены по типам (Контакты — активные ЛС, Чаты — группы, Доски — доски)",
      "Компоузер: выровнен по ширине полотна чата, кнопки стали компактнее и прямоугольнее",
      "Эмодзи‑панель: компактный размер и уменьшенные вкладки",
      "Горячая клавиша: F1 стала крупнее",
    ],
    fixed: [
      "Mobile long‑press: дополнительное подавление клика после открытия контекстного меню",
      "Android/PWA: высота вьюпорта больше не опирается на outerHeight вне iOS",
    ],
  },
  {
    version: "0.1.161",
    date: "2025-12-24",
    improved: [
      "Мобильная боковая панель: вкладки перенесены вниз и добавлена вкладка «Доски»",
      "Десктоп: нижняя навигация по разделам в сайдбаре (Контакты/Доски/Чаты)",
    ],
  },
  {
    version: "0.1.160",
    date: "2025-12-24",
    improved: ["Контекстное меню: группировка, эмодзи‑иконки, компактный mobile‑sheet без затемнения"],
    fixed: ["Mobile long‑press: открытие контекстного меню больше не активирует чат"],
  },
  {
    version: "0.1.159",
    date: "2025-12-24",
    fixed: ["Производительность: снижена нагрузка при вводе (превью в списках не пересчитываются на каждое нажатие)"],
  },
  {
    version: "0.1.158",
    date: "2025-12-24",
    improved: [
      "Чаты/доски: превью последнего сообщения под именем (как у контактов)",
      "Отображение сообщений: «Елочка/Компактный/Текстовый» теперь визуально отличаются",
    ],
    fixed: ["Чат: уменьшен «желе‑эффект» при прокрутке на touch"],
  },
  {
    version: "0.1.157",
    date: "2025-12-24",
    improved: ["Отображение сообщений: режимы «Елочка/Список/Компактный» заметно меняют вид на мобильных"],
    fixed: ["Профиль: режим «Елочка» отображается корректным названием"],
  },
  {
    version: "0.1.156",
    date: "2025-12-24",
    improved: ["Контакты: превью последнего сообщения под именем без открытия чата"],
  },
  {
    version: "0.1.155",
    date: "2025-12-24",
    added: ["Файлы: окно отправки с превью и подписью (как в Telegram)"],
  },
  {
    version: "0.1.154",
    date: "2025-12-24",
    added: ["Профиль: выбор отображения сообщений (облачка / текстовый / компактный)"],
  },
  {
    version: "0.1.153",
    date: "2025-12-24",
    improved: ["Файлы: вставка/drag&drop берут подпись из поля ввода (если один файл)"],
    fixed: ["Файлы: вставка из буфера нормализует имя/расширение, отказ сервера больше не выглядит как «отправлено»"],
  },
  {
    version: "0.1.152",
    date: "2025-12-24",
    fixed: ["Чат: авто‑прокрутка к последнему сообщению при открытии и после отправки"],
  },
  {
    version: "0.1.151",
    date: "2025-12-24",
    improved: ["Поиск: добавлены локальные результаты по контактам, чатам/доскам и истории сообщений"],
  },
  {
    version: "0.1.150",
    date: "2025-12-24",
    improved: ["Hotkeys: F10 показывает «выход» или «зайти» в зависимости от статуса входа"],
  },
  {
    version: "0.1.149",
    date: "2025-12-24",
    improved: ["Эмодзи: увеличен размер в панели и в сообщениях, где только эмодзи (x2)"],
  },
  {
    version: "0.1.148",
    date: "2025-12-24",
    improved: ["Профиль чата/доски: кнопки «Покинуть» и «Удалить для всех» с подтверждением"],
  },
  {
    version: "0.1.147",
    date: "2025-12-24",
    improved: ["Контакты: кнопка «Выход» убрана из списка (осталась в меню)"],
  },
  {
    version: "0.1.146",
    date: "2025-12-24",
    fixed: [
      "Сеть: автопереподключение ставится на паузу при offline/background (меньше «бесконечного» reconnect)",
      "iPhone: ограничиваем объём локальной истории при смене чатов (меньше зависаний/чёрного экрана)",
    ],
  },
  {
    version: "0.1.145",
    date: "2025-12-24",
    improved: ["Контакты: убраны дубли «Info/Создать чат/Создать доску» из контакт‑листа на десктопе (есть в меню)"],
  },
  {
    version: "0.1.144",
    date: "2025-12-24",
    improved: ["Авторизация: вход по ID или @логину (если логин задан)"],
  },
  {
    version: "0.1.143",
    date: "2025-12-24",
    added: [
      "Чаты/доски: описание и правила при создании и в профиле (редактирование владельцем)",
      "Инвайты: карточка с описанием/правилами + кнопки «Вступить/Отклонить/Спам»",
    ],
    improved: ["Инвайты: блокировка отправителя из карточки приглашения"],
  },
  {
    version: "0.1.142",
    date: "2025-12-23",
    improved: ["Меню: кнопки входа/выхода перенесены в меню, добавлен выход по F10"],
    fixed: ["Hotkeys: F10 не конфликтует с Shift+F10 (контекстное меню)"],
  },
  {
    version: "0.1.141",
    date: "2025-12-23",
    improved: [
      "Чат: фото группируются в компактные альбомы (3+ подряд), превью не растягиваются на всю ширину",
      "Чат/Файлы: превью стали компактнее, при наведении мягко увеличиваются",
    ],
    fixed: ["Чат: горизонтальные свайпы по истории блокируются, меньше «двигается полотно»"],
  },
  {
    version: "0.1.140",
    date: "2025-12-23",
    improved: [
      "Файлы: передачи группируются пачками, показывают адресата и быстрый переход к профилю",
      "Файлы: предпросмотр фото/видео с кликом на скачивание, повторные скачивания идут из кэша",
      "Файлы: управление кэшем (лимит 1/5/10/30 ГБ, автоочистка день/неделя/месяц, кнопка очистки)",
    ],
    fixed: ["Кэш файлов: учитываем лимиты и удаляем старые записи по политике"],
  },
  {
    version: "0.1.139",
    date: "2025-12-23",
    improved: [
      "Создание чатов/досок: карточные блоки формы как в профиле, без растяжения при закрытии клавиатуры",
      "Контакты (светлая тема): hover выбранного контакта темнее и читабельнее",
    ],
    fixed: ["Чат: полотно истории лучше фиксируется на touch (только вертикальный свайп)"],
  },
  {
    version: "0.1.138",
    date: "2025-12-23",
    improved: [
      "Профиль: при изменении полей страница не сбрасывает скролл наверх",
      "Контакты (светлая тема): hover/selected контрастнее, выделение темно‑синее",
    ],
    fixed: ["Чат: полотно истории стабильнее на touch (меньше «сдвига» при свайпе)"],
  },
  {
    version: "0.1.137",
    date: "2025-12-23",
    improved: [
      "Профиль: переключение светлой/тёмной темы больше не меняет скин",
      "Telegram-exact: добавлен тёмный режим с адаптивными токенами",
      "Меню (мобильное): крупные кнопки и более заметная подсветка",
    ],
    fixed: [
      "Скины: при ошибке загрузки списка текущий скин не сбрасывается",
      "Список чатов: выбранный контакт читается лучше (контраст в selected)",
    ],
  },
  {
    version: "0.1.136",
    date: "2025-12-23",
    fixed: ["PWA: исправлен некорректный regex в SW (регистрация в Chrome/Safari)"],
  },
  {
    version: "0.1.135",
    date: "2025-12-23",
    improved: [
      "PWA уведомления: авто‑регистрация SW при отсутствии + более ранний запуск регистрации",
      "PWA уведомления: статус ошибки регистрации SW",
    ],
  },
  {
    version: "0.1.134",
    date: "2025-12-23",
    improved: [
      "PWA уведомления: таймаут ожидания SW + детальные статусы (нет регистрации/контроллера)",
      "PWA уведомления: диагностика ошибок getSubscription",
    ],
  },
  {
    version: "0.1.133",
    date: "2025-12-23",
    improved: [
      "PWA уведомления: авто‑подписка с повторными попытками и статусом проверки SW",
      "PWA уведомления: статус 'Push уже включен' при совпадении подписки",
    ],
  },
  {
    version: "0.1.132",
    date: "2025-12-23",
    improved: ["PWA уведомления: авто‑подписка при наличии разрешения", "PWA уведомления: расширенная диагностика статуса"],
  },
  {
    version: "0.1.131",
    date: "2025-12-23",
    fixed: ["PWA уведомления: запрос разрешения совместим с Safari (callback/promise API)"],
  },
  {
    version: "0.1.130",
    date: "2025-12-23",
    fixed: ["Mac/Safari: запрос разрешений на уведомления выполняется сразу по клику"],
  },
  {
    version: "0.1.129",
    date: "2025-12-23",
    improved: ["Уведомления: запрос разрешения доступен даже после запрета, с подсказкой по настройкам"],
  },
  {
    version: "0.1.128",
    date: "2025-12-23",
    added: ["Профиль: кнопка «Принудительно обновить PWA» для ручного обновления клиента"],
  },
  {
    version: "0.1.127",
    date: "2025-12-23",
    added: [
      "PWA: Web Push подписка + управление в профиле (при наличии ключей на сервере)",
      "PWA: потоковые скачивания больших файлов через Service Worker (без удержания в памяти)",
    ],
    improved: [
      "PWA: локальные уведомления при скрытой вкладке (если разрешены)",
      "iOS/PWA: безопаснее вычисляется высота для устранения «чёрной полосы»",
      "Контекст‑меню на touch: меньше ложного выделения и системных меню",
    ],
  },
  {
    version: "0.1.126",
    date: "2025-12-23",
    added: ["PWA: share_target (Поделиться → Yagodka) с приёмом файлов через Service Worker"],
    improved: ["PWA: runtime‑кэш теперь только для статических ассетов, с лимитами и без кэширования лишних GET"],
  },
  {
    version: "0.1.125",
    date: "2025-12-23",
    added: ["Профили чатов/досок: список участников и быстрые действия"],
    improved: [
      "Чаты: запрет писать для отдельных участников (индикатор + блокировка композера)",
      "Профиль: быстрый переключатель светлого/тёмного скина",
      "Контекст‑меню: компактнее и ближе к Telegram",
    ],
  },
  {
    version: "0.1.124",
    date: "2025-12-23",
    improved: [
      "Эмодзи: панель в стиле Telegram Web (поиск, вкладки, секции, анимация открытия)",
      "Эмодзи: более ровный рендер за счёт emoji‑font стека и font‑variant‑emoji",
    ],
  },
  {
    version: "0.1.123",
    date: "2025-12-23",
    added: ["Скин `telegram-exact`: палитра, типографика и размеры под Telegram Web (tweb)"],
    improved: [
      "Telegram-скин: пузырьки с хвостиками, ровные разделители списка, корректные размеры аватаров",
      "Telegram-скин: иконка отправки заменена на бумажный самолётик, без лишних теней/blur",
    ],
  },
  {
    version: "0.1.122",
    date: "2025-12-23",
    fixed: ["Android/PWA: не используем screen.height на не‑iOS — поле ввода не уезжает под экран"],
  },
  {
    version: "0.1.121",
    date: "2025-12-23",
    fixed: [
      "Чат: автоскролл удерживает низ при открытии и наборе текста (не «застревает» посередине)",
      "История: автоскролл теперь зависит от sticky-флага, а не от текущего clientHeight (устойчиво при изменении высоты ввода)",
    ],
  },
  {
    version: "0.1.120",
    date: "2025-12-23",
    fixed: [
      "Чат: показываем имя отправителя по профилю/handle (особенно в группах), можно открыть профиль кликом по имени/аватару",
      "Контекст‑меню сообщений: добавлен пункт «Профиль отправителя»",
      "Android/PWA: клавиатура надёжнее срабатывает по visualViewport (меньше «уезжает» поле ввода)",
    ],
  },
  {
    version: "0.1.119",
    date: "2025-12-23",
    fixed: [
      "Чаты: при открытии снова держим скролл у низа, даже если картинки догружаются (не «в середине истории»)",
      "iOS/Touch: кастомная каретка отключена на тач‑устройствах — меньше кривых позиций после клавиатуры",
      "Viewport: клавиатура считается активной только при фокусе на input/textarea (меньше ложных сдвигов)",
    ],
    improved: [
      "Контекст‑меню на мобилке компактнее (не на пол‑экрана)",
      "Скины: унифицирована типографика/геометрия под Telegram‑схему",
    ],
  },
  {
    version: "0.1.118",
    date: "2025-12-23",
    fixed: [
      "iPhone/PWA: убрали постоянный fixed для html/#app — чёрная полоса снизу должна исчезнуть",
      "iOS: сдвиг visualViewport применяется только при активной клавиатуре (app-vv-offset)",
    ],
  },
  {
    version: "0.1.117",
    date: "2025-12-23",
    fixed: ["iPhone/PWA: усилили фуллскрин (html фиксируется, высота берётся из --app-vh) — меньше шансов на чёрную полосу снизу"],
    improved: ["Viewport: --app-vh/--safe-bottom теперь пишем и в :root, чтобы iOS корректно растягивал layout"],
  },
  {
    version: "0.1.116",
    date: "2025-12-23",
    fixed: [
      "Mobile: поиск в сайдбаре больше не теряет фокус (клавиатура не закрывается после 1 символа)",
      "Медиа: превью в истории стабильнее (MIME прокидывается, HEIC/HEIF распознаются, кеш восстанавливается даже без MIME)",
      "Статусы: queued/delivered теперь визуально различимы",
    ],
    improved: [
      "Context menu на touch компактнее и без выделения текста/IOS callout",
      "iOS/PWA: обновляем высоту при pageshow/visibility и ограничиваем авто‑масштаб при клавиатуре",
    ],
  },
  {
    version: "0.1.115",
    date: "2025-12-23",
    improved: [
      "Медиа: изображения из истории больше не «пропадают» после перезахода — восстанавливаем превью из CacheStorage (blob cache) и подставляем `blob:` URL в UI",
      "Медиа: для последних маленьких картинок делаем тихую подзагрузку (без спама в статус‑строке), чтобы чат выглядел как «настоящий» мессенджер",
    ],
    added: [
      "Helper: `fileBlobCache` (CacheStorage) для превью изображений",
      "Repro: `public/repro/ios-input-assistant.html` — страница для проверки iOS PWA панели над клавиатурой",
      "Regress: `fileBlobCache.test.mjs`",
      "Regress: `iosInputAssistantReproPage.test.mjs`",
    ],
  },
  {
    version: "0.1.114",
    date: "2025-12-23",
    improved: [
      "Медиа: file viewer теперь открывается поверх приложения (fullscreen overlay) — ближе к Telegram и не «ломает» чат/прокрутку",
      "Медиа: превью изображений в чате стало чуть крупнее и аккуратнее (без лишних рамок)",
      "Файлы: превью изображений в списке файлов без лишней обводки (без «двойной рамки»)",
    ],
    fixed: ["Viewer: клик по фону закрывает просмотр (как ожидаемо на мобильных)"],
    added: ["Regress: `fileViewerOverlayPolicy.test.mjs` (overlay + CSS)"],
  },
  {
    version: "0.1.113",
    date: "2025-12-23",
    fixed: [
      "iPhone/PWA: #app на мобилке снова держит высоту через `--app-vh` (вместо bottom var) — меньше шансов на чёрную полосу снизу и «улёт» строки ввода",
    ],
    improved: [
      "Mobile: `nav-overlay` и `sidebar` теперь позиционируются относительно #app (absolute), поэтому при iOS visualViewport сдвигах меньше «разъезжается» интерфейс",
      "Viewport: математика keyboard/offsetTop/bottom теперь считается от layout viewport, а `screen.height` используется только для высоты без клавиатуры (меньше ложных срабатываний)",
    ],
  },
  {
    version: "0.1.112",
    date: "2025-12-23",
    fixed: ["Контакт: убрали лишнюю кнопку «Назад» внизу (используем back в шапке)"],
    improved: [
      "Контакт: CTA «Сообщение» теперь сразу под шапкой профиля (Telegram‑паттерн)",
      "Cyberberry CRT: CRT‑оверлей (#app::before/#app::after) учитывает visualViewport top/bottom — меньше артефактов при клавиатуре в iOS PWA",
    ],
    added: ["Regress: `userPagePolish.test.mjs`", "Regress: `skinCyberberryCrtOverlay.test.mjs`"],
  },
  {
    version: "0.1.111",
    date: "2025-12-23",
    fixed: ["iPhone/PWA: #app на мобилке теперь «поджимается» снизу по visualViewport (bottom var) — меньше шансов на чёрную полосу и «улёт» композера при фокусе"],
    improved: ["iOS PWA: input‑assistant (Undo/Redo/✓) применяется и при программном фокусе полей (модалки/страницы) — панель появляется реже"],
    added: ["Helper: `focusElement` для безопасного фокуса на input/textarea", "Regress: обновлены тесты viewport/mobile fullscreen под `--app-vv-bottom`"],
  },
  {
    version: "0.1.110",
    date: "2025-12-23",
    improved: [
      "Mobile: на экранах (профиль/контакт/поиск/файлы/info) кнопка в шапке теперь «Назад» (без необходимости Esc)",
      "Mobile: профиль/контакт ближе к Telegram — крупный аватар, центрирование, кнопки в сетке, меньше визуального шума",
    ],
    added: ["Regress: `mobilePagesPolishCss.test.mjs`", "Regress: renderHeader проверяет `nav-back` на страницах"],
  },
  {
    version: "0.1.109",
    date: "2025-12-23",
    improved: [
      "Mobile: композер ближе к Telegram — «бар» стал цельнее (лёгкий blur/прозрачность), текст плотнее и чуть жирнее",
      "iPhone/PWA: стабильнее реагируем на клавиатуру (учитываем реальную «закрытую снизу» часть viewport, слушаем scroll/focus)",
    ],
    added: ["Regress: `mobileComposerPolishCss.test.mjs`"],
  },
  {
    version: "0.1.108",
    date: "2025-12-23",
    fixed: ["iPhone/PWA: учли `visualViewport.offsetTop` — убрали чёрную полосу снизу и «улёт» строки ввода при клавиатуре"],
    added: ["Regress: viewport учитывает `visualViewport.offsetTop`", "Regress: mobile fullscreen использует `top: var(--app-vv-top, 0px)`"],
  },
  {
    version: "0.1.107",
    date: "2025-12-23",
    improved: ["Mobile: список диалогов ближе к Telegram (сепараторы, time/unread в колонку, крупнее аватар)"],
    added: ["Mobile: online‑точка на аватаре в списке диалогов", "Regress: `mobileDialogsListCss.test.mjs`"],
  },
  {
    version: "0.1.106",
    date: "2025-12-23",
    fixed: [
      "iPhone/PWA: #app теперь фиксирован (fixed) на мобильных — меньше шансов на «уехавший» лейаут/прокрутку и чёрные полосы по краям",
      "iPhone/PWA: фон приложения принудительно покрывает весь экран (включая safe-area снизу)",
    ],
    improved: ["Viewport: при фокусе на input/textarea переключаемся на visualViewport даже при меньшей разнице (надёжнее при клавиатуре)"],
    added: ["Regress: тесты на mobile fullscreen (`position: fixed`) и keyboard‑эвристику при фокусе"],
  },
  {
    version: "0.1.105",
    date: "2025-12-23",
    improved: ["iOS PWA: input‑assistant получил режимы `predictive/strict` (чётче контролируем появление панели Undo/Redo/✓ над клавиатурой)"],
    added: ["Regress: `iosInputAssistantWorkaround` покрывает режим `strict`"],
    fixed: ["Dev: `npm test` больше не подхватывает чужие `*.test.*` вне `client-web/test/` (ускоряет web-check)"],
  },
  {
    version: "0.1.104",
    date: "2025-12-22",
    fixed: ["iPhone/PWA: если видна полоса снизу — используем `screen.height`, когда он близок к viewport (закрывает safe-area)"],
    added: ["Regress: viewport использует `screen.height` в «безопасном» диапазоне"],
  },
  {
    version: "0.1.103",
    date: "2025-12-22",
    fixed: [
      "iPhone/PWA: композер больше не «подпрыгивает» вверх при клавиатуре (safe-area снизу отключаем, пока клавиатура открыта)",
      "iPhone/PWA: #app высота учитывает clientHeight (safe-area) — меньше шансов на чёрную полосу снизу",
    ],
    improved: ["Viewport: добавили регресс‑тест на clientHeight (safe-area)"],
  },
  {
    version: "0.1.102",
    date: "2025-12-22",
    improved: ["Mobile: контекстные меню на touch теперь открываются как bottom‑sheet (как в Telegram)"],
    added: ["Регресс‑тест: `contextMenuSheet.test.mjs`"],
  },
  {
    version: "0.1.101",
    date: "2025-12-22",
    fixed: ["Mobile + скины: mobile‑настройки теперь не перебиваются скином (используем `:root[data-skin]` и более специфичные селекторы)"],
    improved: ["Mobile: композер и пузырьки стали компактнее (меньше внутренних отступов/зазоров)"],
    added: ["Регресс‑тест: `mobileResponsiveOverrides.test.mjs`"],
  },
  {
    version: "0.1.100",
    date: "2025-12-22",
    fixed: ["Mobile: усилили фуллскрин‑лейаут независимо от скина (прямые `padding/border/radius/shadow/overflow`) — меньше шансов, что UI «уедет»"],
  },
  {
    version: "0.1.99",
    date: "2025-12-22",
    improved: ["iOS/mobile: включили инерционную прокрутку для списков/истории (`-webkit-overflow-scrolling: touch`)"],
    added: ["Регресс‑тест: `mobileScrollContainers.test.mjs` (защита от потери инерции на iOS)"],
  },
  {
    version: "0.1.98",
    date: "2025-12-22",
    fixed: ["ПКМ по контакту/чату: усилили стабилизацию скролла (scroll-lock на время открытия меню) — список не «улетает»"],
  },
  {
    version: "0.1.97",
    date: "2025-12-22",
    added: ["Mobile: в сайдбаре добавили строку поиска (локальный фильтр) для вкладок «Чаты/Контакты»"],
    improved: ["Mobile: верх сайдбара (заголовок/табы/поиск) теперь sticky — удобнее навигация как в Telegram"],
  },
  {
    version: "0.1.96",
    date: "2025-12-22",
    added: ["iOS (Safari): ненавязчивая подсказка установки PWA (Поделиться → «На экран Домой»)"],
    improved: ["Info: добавили раздел «Установка на телефон» (iOS/Android)"],
  },
  {
    version: "0.1.95",
    date: "2025-12-22",
    improved: [
      "iOS/PWA: `--app-vh` теперь берём из innerHeight по умолчанию (закрывает safe-area без «чёрной полосы»), а на visualViewport переключаемся только при большой разнице (клавиатура)",
    ],
    added: ["Регресс‑тесты: `appViewportVar.test.mjs` расширен (innerHeight vs visualViewport)"],
  },
  {
    version: "0.1.94",
    date: "2025-12-22",
    improved: [
      "iOS/PWA: добавили JS‑переменную высоты `--app-vh` (через visualViewport/innerHeight) и подключили её в CSS (#app height/min-height) — меньше шансов, что composer/скролл «уедут» при адрес-баре/клавиатуре",
    ],
    added: ["Регресс‑тесты: `appViewportVar.test.mjs` проверяет CSS и установку `--app-vh`"],
  },
  {
    version: "0.1.93",
    date: "2025-12-22",
    fixed: ["iOS/PWA: убрали min-height:-webkit-fill-available из базового #app (оставили только в fallback без 100dvh) — меньше шансов на «прыжки» и поломанную прокрутку"],
    improved: ["Добавлен регресс‑тест: скины не должны переопределять `.hidden` (это ломает лейаут/скролл)"],
  },
  {
    version: "0.1.92",
    date: "2025-12-22",
    fixed: [
      "iOS/PWA: исправили «разъезд» лейаута/потерю скролла — больше не форсим height:-webkit-fill-available на современных движках (оставили только fallback, если нет 100dvh)",
      "Скролл: добавили min-height/min-width:0 для sidebar/chat/chat-host (корректный overflow:auto внутри grid/flex)",
    ],
    improved: ["Cyberberry CRT: overlay.hidden больше не переопределяет display (меньше рисков для скролла/верстки)"],
  },
  {
    version: "0.1.91",
    date: "2025-12-22",
    improved: [
      "Mobile sidebar: добавили третью вкладку «Меню» (как отдельный раздел, без смешивания с контактами)",
      "Mobile sidebar: навигацию/создание (Поиск/Профиль/Файлы/Info/Создать чат/Создать доску) перенесли из «Контакты» в «Меню»",
      "Подсказки: в «Меню» добавили компактный блок «Подсказки» + описания/tooltip’ы на пунктах",
    ],
  },
  {
    version: "0.1.90",
    date: "2025-12-22",
    improved: [
      "Доски: инвайты теперь доставляются и оффлайн (при следующем входе), как у чатов",
      "Приватные доски: «Принять приглашение» работает корректно (вступление через подтверждение инвайта, а не через public join)",
    ],
    fixed: ["Доски: «Отклонить приглашение» теперь сообщает серверу — приглашение не приходит повторно"],
  },
  {
    version: "0.1.89",
    date: "2025-12-22",
    improved: ["Сайдбар: убрали отдельную секцию «Ожидают» — запросы/инвайты теперь подсвечиваются прямо в списке контактов"],
    fixed: ["Сайдбар: запросы от неизвестных пользователей не теряются — показываем их отдельными строками в блоке «Внимание»"],
  },
  {
    version: "0.1.88",
    date: "2025-12-22",
    improved: [
      "iPhone/Android: #app теперь предпочитает 100dvh (вместо 100svh), меньше шансов на «пустую» полосу снизу при нестабильных viewport-юнитах",
    ],
    fixed: ["Сайдбар: дополнительная стабилизация скролла при ПКМ/контекстном меню (без резких прыжков списка)"],
    added: ["Repro: public/ios-input-lab.html — минимальная страница для проверки iOS input toolbar (Undo/Redo/✓)"],
  },
  {
    version: "0.1.87",
    date: "2025-12-22",
    added: ["Контакты: контекстное меню → «Пригласить в чат/доску…» с выбором ваших чатов/досок (инвайт приходит пользователю в ЛС)"],
    improved: [
      "Инвайты/авторизация/входящие файлы: больше нет блокирующих action‑модалок — всё отображается как системные сообщения в ЛС с кнопками действий",
      "Медиа в чате: изображения показываются без «карточной» рамки, а кнопки принять/скачать — поверх превью (прогресс upload/download — деликатным оверлеем)",
    ],
    fixed: ["Файлы: входящий file_offer больше не открывает модалку автоматически — ничего не перекрывает чат"],
  },
  {
    version: "0.1.86",
    date: "2025-12-22",
    improved: [
      "Файлы/медиа: можно добавить подпись к фото/файлу (берём текст из композера при отправке одного файла) — подпись сохраняется в истории и рендерится под превью",
      "Сообщения с вложением: разрешили редактировать подпись через контекстное меню (Изменить подпись…)",
    ],
  },
  {
    version: "0.1.85",
    date: "2025-12-22",
    improved: [
      "Сообщения: при редактировании показываем время правки («изменено HH:MM»), а сервер теперь отдаёт edited_ts в истории/бэклоге",
    ],
  },
  {
    version: "0.1.84",
    date: "2025-12-22",
    added: ["Android: предложение установить PWA (beforeinstallprompt) — показываем ненавязчивый toast «Установить/Позже»"],
    improved: [
      "iPhone (Safari/PWA): добавлен fallback на -webkit-fill-available для стабильно полного экрана (#app) — меньше шансов на пустую полосу снизу",
      "Toast: поддержаны произвольные actions (нужно для install‑prompt и будущих сценариев)",
    ],
  },
  {
    version: "0.1.83",
    date: "2025-12-22",
    improved: ["iOS PWA: для композера включаем autocorrect/spellcheck/autocapitalize до focus — панель Undo/Redo/✓ появляется заметно реже"],
    added: [
      "Repro: public/repro/ios-input-assistant.html — минимальная страница для сравнения strict vs iOS-friendly режимов",
      "Regress tests: iosInputAssistantWorkaround — проверка, что workaround включает нужные атрибуты в iOS standalone",
    ],
    notes: ["Полностью отключить системную панель в WebKit нельзя; цель — снизить частоту появления и вернуть нормальную клавиатуру с подсказками."],
  },
  {
    version: "0.1.82",
    date: "2025-12-22",
    added: ["Web: добавлена поддержка React (Vite plugin + TSX) для постепенного внедрения компонентного UI"],
    improved: ["Info: добавлен небольшой бейдж «React» (проверка, что связка реально работает)"],
    notes: ["Оставляем основной UI на vanilla TS; React используем точечно. Vue подключим отдельно, если решим, что он действительно нужен."],
  },
  {
    version: "0.1.81",
    date: "2025-12-22",
    improved: [
      "Composer: системный sans‑шрифт и более «телеграмовское» ощущение ввода",
      "Composer: автофокус после выбора чата включён и для touch (с небольшой задержкой, чтобы не конфликтовать с закрытием drawer)",
      "Курсор/каретка: кастомная каретка стала менее «шумной» (мягче свечение, без жёсткого градиента)",
    ],
    added: ["Regress test: composer tokens (sans font + font-size>=16 для iOS)"],
  },
  {
    version: "0.1.80",
    date: "2025-12-22",
    fixed: ["Сайдбар: при открытии контекстного меню (ПКМ/Ctrl+Click) список больше не должен «скакать» — фиксируем scroll до закрытия меню"],
    added: ["Regress test: rafScrollLock — проверка scroll-lock на requestAnimationFrame"],
  },
  {
    version: "0.1.79",
    date: "2025-12-22",
    improved: [
      "Авторизация: если ID уже сохранён — поле ID блокируется от случайного редактирования, но его можно быстро «разблокировать» кнопкой «Сменить ID»",
      "Dropdown/select: стрелка и hover/focus стали заметнее, сохранили нативное поведение",
    ],
    added: ["Regress tests: auth ID-lock (rememberedId → readonly + «Сменить ID»)"],
  },
  {
    version: "0.1.78",
    date: "2025-12-22",
    improved: [
      "Mobile: фуллскрин принудительно для всех скинов (Safari + PWA) — без «карточки» и лишних отступов",
      "Mobile: composer учитывает safe-area снизу без ощущения «двойного» паддинга",
    ],
    added: ["Regress tests: mobile safe-area CSS (fullscreen overrides + composer padding)"],
  },
  {
    version: "0.1.77",
    date: "2025-12-22",
    improved: [
      "iOS PWA: workaround для системной панели Undo/Redo/✓ применяется до focus (pointerdown/touchstart) — проявляется заметно реже",
      "Авторизация: поле ID помечено data-ios-assistant=off (не вмешиваемся в numeric‑ввод)",
    ],
    added: ["Диагностика iOS: обновлена страница /ios-input-bar-test.html (режимы attrs=off/workaround/none + isIOS/standalone)"],
  },
  {
    version: "0.1.76",
    date: "2025-12-22",
    added: [
      "Контакт: отдельная страница профиля (аватар/имя/@handle/ID/статус/био)",
      "Regress tests: sidebar display_name, avatar_rev storage, handleServerMessage avatar",
    ],
    improved: [
      "Контакты/чаты: если у пользователя задано имя, показываем его вместо голого ID (в сайдбаре, шапке и статус-строке)",
      "Профиль: добавлены поля «Статус» и «О себе» (bio), сохранение через серверный profile_set",
      "Аватары: серверная синхронизация (avatar_set/clear/get) + локальный кэш с avatar_rev",
    ],
  },
  {
    version: "0.1.75",
    date: "2025-12-22",
    improved: [
      "Файлы/медиа: вложения в чате и на странице «Файлы» теперь выглядят как аккуратные карточки (иконка типа, превью сверху для изображений, компактные кнопки действий)",
      "Прикрепление: выбор нескольких файлов за раз (multi-select) — удобнее отправлять пачками",
    ],
    fixed: ["UI: иконки действий у файлов (accept/reject/download) корректно отображаются во всех браузерах"],
    added: ["Regress tests: fileBadge и renderChatFileRow"],
  },
  {
    version: "0.1.74",
    date: "2025-12-22",
    improved: [
      "PWA update: service worker активируется сразу после установки (skipWaiting) — обновления подхватываются надёжнее",
      "PWA update: если SW уже на новой версии, а вкладка ещё на старой — делаем тихий перезапуск только когда безопасно (idle + нет активных загрузок + нет фокуса в полях ввода)",
      "Boot: при обновлении сначала делаем один «мягкий» reload (как Ctrl+R), и только потом — тяжёлый recover (unregister SW + очистка caches), если запуск всё ещё не удался",
    ],
    added: ["Regress test: shouldReloadForBuild — проверка логики «нужен ли перезапуск по buildId»"],
  },
  {
    version: "0.1.73",
    date: "2025-12-22",
    fixed: ["Чат: закреп/поиск теперь физически отделены от истории и не «уезжают» при прокрутке"],
    improved: ["Чат: скролл перенесён в chatHost (стабильнее jump‑to‑bottom и автоподгрузка истории)"],
    added: ["Regress test: chatFixedTop — проверка, что закреп/поиск рендерятся в chatTop, а не внутри истории"],
  },
  {
    version: "0.1.72",
    date: "2025-12-22",
    fixed: ["Сайдбар: ПКМ/Ctrl+Click больше не активирует строку и не должен «дёргать» прокрутку списка"],
    improved: ["iOS PWA: усилили workaround для панели Undo/Redo/✓ (включаем autocapitalize=sentences вместе с autocorrect/spellcheck)"],
    added: ["Regress test: sidebarContextClick — проверка, что Ctrl+Click/ПКМ не меняет выбранный чат"],
  },
  {
    version: "0.1.71",
    date: "2025-12-22",
    improved: [
      "Автовход: в шапке показываем «Входим…» (можно открыть вход вручную), чтобы меньше было «дёрганий» при старте",
      "Сессии: при успешном входе обновляем срок жизни токена в cookie/localStorage (даже если сервер не присылает session повторно)",
      "Composer: эмодзи‑кнопка теперь корректно disabled, а поповер закрывается при смене чата/страницы",
    ],
    added: ["Security regression: тесты на формат/хранилище session token и cookie‑параметры (SameSite=Strict, Secure на https)"],
  },
  {
    version: "0.1.70",
    date: "2025-12-22",
    added: ["Composer: кнопка эмодзи с быстрым пикером и списком «недавних» (локально на устройстве)"],
    improved: ["Профиль: аккуратная шапка (аватар/имя/@handle/ID) и секции «Аккаунт/Интерфейс» — ближе к привычному стилю мессенджеров"],
  },
  {
    version: "0.1.69",
    date: "2025-12-22",
    improved: [
      "Mobile: нижняя панель навигации убрана — теперь экран чище, а composer находится строго внизу (с учётом safe-area)",
      "Mobile: в боковом меню добавлены вкладки «Чаты/Контакты» (как в Telegram по смыслу): «Чаты» показывает только начатые диалоги и комнаты, «Контакты» — адресную книгу + навигацию (Поиск/Профиль/Файлы/Info)",
    ],
  },
  {
    version: "0.1.68",
    date: "2025-12-21",
    fixed: [
      "Чат: панель закрепа и поиск теперь закреплены над историей и не «уезжают» при прокрутке",
      "Редактирование сообщений: правка применяется устойчивее (fallback по msg_id, даже если в payload нет room/to)",
      "Сайдбар: ПКМ/Ctrl+Click больше не должен «ронять» скролл списка (lock scroll во время открытия меню)",
    ],
  },
  {
    version: "0.1.67",
    date: "2025-12-21",
    improved: ["Надёжность отправки: добавлена локальная outbox‑очередь (offline→send) с автоповтором на reconnect и дедупом по истории"],
  },
  {
    version: "0.1.66",
    date: "2025-12-21",
    fixed: ["Сайдбар: остаточные «скачки» скролла при ПКМ/Ctrl+Click по контактам/чатам устранены (стабилизация scroll snapshot + дедуп Pointer/Mouse)"],
  },
  {
    version: "0.1.65",
    date: "2025-12-21",
    fixed: ["Надёжность отправки: ACK (msg_id) теперь присваивается FIFO, без риска перепутать статусы при быстрой отправке нескольких сообщений"],
  },
  {
    version: "0.1.64",
    date: "2025-12-21",
    improved: ["Mobile: общий UI‑шрифт стал более «телеграмовским» (system sans), список чатов получил разделители с отступом от аватара"],
  },
  {
    version: "0.1.63",
    date: "2025-12-21",
    improved: [
      "Composer: кнопка отправки теперь выглядит «неактивной», когда отправлять нельзя (не вводит в заблуждение)",
      "Mobile: поле ввода сообщений использует системный sans‑шрифт (ближе к Telegram по ощущению)",
      "Автофокус composer: на iPad/гибридных устройствах с мышью/трекпадом фокус ставится сразу после выбора чата",
    ],
  },
  {
    version: "0.1.62",
    date: "2025-12-21",
    improved: ["Labs: ios-input-assistant.html теперь содержит атрибуты поля ввода прямо в HTML (проверка работает даже при строгом CSP)"],
  },
  {
    version: "0.1.61",
    date: "2025-12-21",
    improved: [
      "iOS PWA: workaround для панели Undo/Redo/✓ применяется при фокусе на текстовые поля (кроме полей ID/@handle)",
      "Добавлена диагностическая страница: /labs/ios-input-assistant.html",
    ],
  },
  {
    version: "0.1.60",
    date: "2025-12-21",
    improved: ["Авторизация: добавлены кнопки «показать/скрыть пароль» в окне входа/регистрации"],
  },
  {
    version: "0.1.59",
    date: "2025-12-21",
    fixed: ["ПКМ по контакту/чату в сайдбаре больше не «роняет» скролл списка (стабилизация до/после contextmenu)"],
  },
  {
    version: "0.1.58",
    date: "2025-12-21",
    improved: ["Убран неиспользуемый legacy web-код (старые файлы app/state/main/style) — меньше путаницы и «мертвых меню»"],
  },
  {
    version: "0.1.57",
    date: "2025-12-21",
    improved: [
      "Composer: кнопка отправки теперь единообразно «ягодка» (без конфликтующих стилей), в режиме редактирования — галочка",
      "Каретка в поле ввода сообщений: оставили нативную (меньше «скачет» на десктопе)",
    ],
  },
  {
    version: "0.1.56",
    date: "2025-12-21",
    added: ["Info (F1) с журналом изменений и мини‑инструкцией прямо в приложении"],
    improved: ["Подгрузка истории изменений порциями по 20 версий (автоподгрузка при прокрутке)"],
  },
  {
    version: "0.1.55",
    date: "2025-12-21",
    fixed: ["После выхода показываем сохранённый ID в шапке (ID больше не «пропадает»)"],
  },
  {
    version: "0.1.54",
    date: "2025-12-21",
    fixed: ["ID в окне входа не очищается при первом открытии модалки (после выхода просит только пароль)"],
    improved: ["Workaround для iOS PWA: панель Undo/Redo/✓ появляется реже при вводе текста"],
  },
];
