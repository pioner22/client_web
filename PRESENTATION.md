# Yagodka Web (PWA) — презентация

Yagodka — клавиатурный мессенджер “как терминал”, но с современным UX: аккуратные списки, быстрый ввод, контекстные меню и PWA‑опыт как у приложения.

## 1) Идея и позиционирование

**Коротко:** “минимальный и быстрый мессенджер, который приятно управляется с клавиатуры и одинаково хорошо работает в браузере и как PWA”.

**Кому подходит:**
- тем, кто много переписывается с ноутбука и любит хоткеи;
- тем, кто хочет лёгкий self‑hosted клиент без тяжёлых UI‑фреймворков;
- тем, кому важны предсказуемые состояния и простая логика интерфейса.

## 2) UX‑принципы

- **Keyboard‑first**: основные действия доступны без мыши.
- **Минимализм без “сырости”**: чистые состояния (hover/pressed/focus/disabled), аккуратные расстояния, читаемая типографика.
- **Mobile‑first**: большие зоны тапа, safe‑area, понятная навигация.
- **Тихие процессы**: авто‑авторизация/обновления без “дёрганий” интерфейса.

## 3) Ключевые возможности (то, что видит пользователь)

**Основной экран**
- Список контактов/чатов/досок (с превью последнего сообщения/файла, временем, непрочитанным).
- Переписка с группировкой, разделителями дат, метаданными.
- Ввод сообщения с авто‑ростом, подсказками и удобными кнопками.

**Контекстные меню (ПКМ / long‑press)**
- Для контакта/чата/доски: открыть, закрепить, mute, block, аватар, очистка и т.п.
- Для сообщения: копировать, закрепить/открепить, изменить, удалить.

**Файлы/медиа**
- Отправка и приём файлов (с прогрессом).
- Превью изображений + viewer (открыть/скачать).
- История передач и входящих предложений.

**PWA**
- Установка на главный экран, `viewport-fit=cover`, поддержка safe‑area.
- Мягкое применение обновлений (в т.ч. обход “чёрного экрана” iOS/WebKit).

## 4) Архитектура (понятно “для презентации”)

Браузер не умеет TCP напрямую, поэтому используется тонкий шлюз:

```
Yagodka Web (Browser/PWA)
        │  WebSocket
        ▼
    ws_gateway
        │  TCP + NDJSON
        ▼
      Server
```

**Почему так хорошо:**
- UI не зависит от внутренностей сервера, протокол простой (NDJSON).
- Клиент лёгкий: быстрый старт, мало магии, предсказуемые баги.

## 5) Технологии

- **Vite + TypeScript**, без React/Vue.
- Рендер UI: DOM‑компоненты и страницы (`src/components/**`, `src/pages/**`).
- Состояние: маленький store с подписками (`src/stores/**`).
- Стили: `src/scss/**` + переключаемые скины `public/skins/**`.
- Тесты: `node --test` (регрессии по состоянию/рендеру), `make web-check` как общий гейт.

## 6) Безопасность (что уже сделано)

- Безопасный рендер ссылок (allowlist протоколов).
- Нет опасных DOM‑sink и `eval` (есть регресс‑тест).
- `target="_blank"` всегда с `rel="noopener noreferrer"` (есть тест).
- Ограничения по размеру сообщений/фреймов и rate‑limit (серверные регресс‑тесты).

## 7) Roadmap (ориентир на UX уровня “tweb”, без копирования кода)

1. **Надёжность ядра чата**: очередь отправки, дедуп при reconnect, корректные статусы доставки/прочтения.
2. **Сессии/авторизация без дерганий**: per‑device sessions, “выйти везде”, тихий авто‑вход.
3. **Composer уровня Telegram**: автокомплит, вложения, стабильная каретка/фокус, safe‑area.
4. **Мобилка**: drawer для списка + bottom tabs, жест “назад”, стабильный масштаб iOS.
5. **Контекстные меню**: полный набор действий (как в TUI), подтверждения разрушительных операций.
6. **Окно сообщений “как у взрослых”**: reply/forward, выделение/копирование, jump‑to‑bottom, поиск в чате.
7. **Медиа**: viewer, предпросмотр, прогресс/ошибки, безопасное хранение.
8. **Профиль/аватары**: загрузка/кроп/кеш, приватность.
9. **PWA‑обновления и запуск**: ещё меньше “ручных перезагрузок”, аккуратные версии 0.1.x в UI.
10. **Security hardening**: расширение регресс‑тестов (XSS/лимиты/ACL/CSP).
11. **Наблюдаемость/QA**: метрики ошибок/latency, smoke‑проверки, CI‑гейт.

## 8) Как показать демо

1) Поднять сервер и gateway (см. `README.md`).
2) Запустить web‑клиент: `npm run dev`.
3) Показать:
- хоткеи и фокус‑навигацию,
- контекстные меню и закрепы,
- отправку файла и viewer,
- PWA‑установку и перезапуск после обновления.

