<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="color-scheme" content="dark" />
    <title>Yagodka — iOS input bar test</title>
    <style>
      :root {
        color-scheme: dark;
      }
      body {
        margin: 0;
        background: #0b0f14;
        color: #e6edf3;
        font:
          500 16px/1.35 ui-sans-serif,
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Arial,
          sans-serif;
        padding: 18px;
        padding-left: calc(18px + env(safe-area-inset-left));
        padding-right: calc(18px + env(safe-area-inset-right));
        padding-bottom: calc(18px + env(safe-area-inset-bottom));
      }
      h1 {
        margin: 0 0 10px;
        font-size: 18px;
        letter-spacing: 0.02em;
      }
      p {
        margin: 0 0 14px;
        opacity: 0.85;
        font-size: 13px;
      }
      .card {
        border: 1px solid rgba(255, 255, 255, 0.14);
        border-radius: 14px;
        background: rgba(255, 255, 255, 0.04);
        padding: 14px;
        display: grid;
        gap: 12px;
        max-width: 720px;
      }
      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
      }
      label {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        cursor: pointer;
      }
      input[type="checkbox"],
      input[type="radio"] {
        width: 18px;
        height: 18px;
      }
      .field {
        width: 100%;
        border: 1px solid rgba(255, 255, 255, 0.16);
        border-radius: 14px;
        background: rgba(255, 255, 255, 0.06);
        color: #e6edf3;
        padding: 12px 12px;
        outline: none;
        font-size: 16px; /* iOS: предотвращает авто-zoom при фокусе */
        line-height: 1.35;
      }
      textarea.field {
        min-height: 108px;
        resize: none;
      }
      .field:focus {
        border-color: rgba(236, 72, 153, 0.75);
        box-shadow: 0 0 0 2px rgba(236, 72, 153, 0.22);
      }
      .meta {
        font-family:
          ui-monospace,
          SFMono-Regular,
          Menlo,
          Monaco,
          Consolas,
          "Liberation Mono",
          "Courier New",
          monospace;
        font-size: 12px;
        opacity: 0.8;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <h1>iOS: панель Undo/Redo/✓</h1>
    <p>
      Откройте эту страницу в Safari iOS и (желательно) в PWA (Add to Home Screen). Нажмите на поле ввода и посмотрите,
      появляется ли системная панель над клавиатурой. Здесь всегда только одно поле — оно пересоздаётся при смене настроек.
    </p>

    <div class="card">
      <div class="controls">
        <label><input type="radio" name="kind" value="textarea" checked /> textarea</label>
        <label><input type="radio" name="kind" value="input" /> input</label>
        <label><input type="radio" name="kind" value="editable" /> contenteditable</label>
        <label><input type="radio" name="attrsMode" value="off" checked /> attrs: off</label>
        <label><input type="radio" name="attrsMode" value="workaround" /> attrs: workaround</label>
        <label><input type="radio" name="attrsMode" value="none" /> attrs: none</label>
      </div>
      <div id="mount"></div>
      <div class="meta" id="meta"></div>
    </div>

    <script>
      const mount = document.getElementById("mount");
      const meta = document.getElementById("meta");

      function attrsOff(el) {
        el.setAttribute("autocomplete", "off");
        el.setAttribute("autocorrect", "off");
        el.setAttribute("autocapitalize", "off");
        el.setAttribute("spellcheck", "false");
        el.setAttribute("inputmode", "text");
        el.setAttribute("enterkeyhint", "done");
      }

      function attrsWorkaround(el) {
        el.setAttribute("autocomplete", "off");
        el.setAttribute("autocorrect", "on");
        el.setAttribute("spellcheck", "true");
        el.setAttribute("autocapitalize", "sentences");
        el.setAttribute("inputmode", "text");
        el.setAttribute("enterkeyhint", "done");
      }

      function isIOS() {
        const ua = String(navigator.userAgent || "");
        const isClassic = /iPad|iPhone|iPod/i.test(ua);
        const isIPadOS = /Macintosh/i.test(ua) && Number(navigator.maxTouchPoints || 0) > 1;
        return isClassic || isIPadOS;
      }

      function isStandalone() {
        try {
          if (navigator.standalone) return true;
        } catch {}
        try {
          return Boolean(
            window.matchMedia?.("(display-mode: standalone)")?.matches || window.matchMedia?.("(display-mode: fullscreen)")?.matches
          );
        } catch {
          return false;
        }
      }

      function build() {
        const kind = document.querySelector("input[name='kind']:checked")?.value || "textarea";
        const attrsMode = document.querySelector("input[name='attrsMode']:checked")?.value || "off";

        const el = document.createElement(kind === "input" ? "input" : kind === "editable" ? "div" : "textarea");
        el.className = "field";
        if (kind !== "editable") el.placeholder = "Пишите здесь…";
        else {
          el.setAttribute("contenteditable", "true");
          el.setAttribute("role", "textbox");
          el.setAttribute("aria-multiline", "true");
          el.textContent = "";
        }
        if (kind === "input") el.type = "text";
        if (attrsMode === "off") attrsOff(el);
        else if (attrsMode === "workaround") attrsWorkaround(el);

        mount.replaceChildren(el);
        try {
          el.focus({ preventScroll: true });
        } catch {
          el.focus();
        }

        const pairs = [];
        for (const name of ["autocomplete", "autocorrect", "autocapitalize", "spellcheck", "inputmode", "enterkeyhint", "type"]) {
          const v = el.getAttribute(name);
          if (v !== null) pairs.push(`${name}="${v}"`);
        }
        if (kind === "editable") pairs.push('contenteditable="true"');
        const ua = String(navigator.userAgent || "");
        meta.textContent =
          `UA: ${ua}\n` +
          `isIOS=${isIOS()}  standalone=${isStandalone()}\n` +
          `Текущее поле: ${kind}  attrs=${attrsMode}\n` +
          (pairs.length ? pairs.join(" ") : "(без специальных атрибутов)");
      }

      document.addEventListener("change", (e) => {
        if (e.target && (e.target.name === "kind" || e.target.name === "attrsMode")) build();
      });

      build();
    </script>
  </body>
</html>
